# open-kappa/arduino-cli-dokcer

Docker images for `arduino-cli` and some cores and packages.

## Motivations

The idea is to have a docker image to:

* To freeze the dependencies
* To have a reproducible firmware
* To have a reproducible and shareable development environment

## Useful links

* Image on Docker Hub:
* Source image repository: <https://github.com/open-kappa/arduino-cli-docker>

## Tags conventions

Naming convention is the following:

```text
open-kappa/arduino-cli:<CLI_VERSION>-<DISTRO>
open-kappa/arduino-cli:<CLI_VERSION>-<DISTRO>-lib<LIB_VERSION>
```

Where:

* **CLI_VERSION**: the version of the provided `arduino-cli`
* **DISTRO**: the name of the image distro. It can be "alpine" or "debian"
* **LIB_VERSION**: a number indicating the upgrade status of provided libraries

Therefore, there are four variants in total:

* **open-kappa/arduino-cli:<CLI_VERSION>-alpine**: Alpine-based image with only
    `arduino-cli`
* **open-kappa/arduino-cli:<CLI_VERSION>-alpine-lib<LIB_VERSION>**: Alpine-based
    image with `arduino-cli` plus some libraries
* **open-kappa/arduino-cli:<CLI_VERSION>-debian**: Debian-based image with only
    `arduino-cli`
* **open-kappa/arduino-cli:<CLI_VERSION>-debian-lib<LIB_VERSION>**: Debian-based
    image with `arduino-cli` plus some libraries

**WARNING**: only Alpine-based variants are prebuilt. Debian vriants must be
generated by hand.

Please check the <CHANGELOG.md> or the `Dockerfile.lib` to see the list of
installed packages, libraries and their respective versions.

## How to use

As default, the image runs `arduino-cli` as a daemon service, with user
"arduino".
Such a user has installed inside its home directory (`/home/arduino`) the
various Arduino packages and the various libs, in the default paths for Linux:

* **/home/arduino/.arduino15**: directory for packages
* **/home/arduino/Arduino/libraries**: directory for libraries

So it is possible to add additional libraries or customize the ones provided
by mounting them inside the container.

A possible way to use this image is:

* Run it as a daemon
* "Docker-Exec" `arduino-cli` commands to compile and upload your sketch

### Example

```bash
docker run --rm --name arduino-cli -d \
    --device /dev/ttyUSB0 \
    -v MySketch:/home/arduino/MySketch \
    open-kappa/arduino-cli:0.33.0-alpine-lib0
```

Then, to compile:

```bash
docker exec -it arduino-cli compile \
    --fqbn esp32:esp32:esp32 \
    MySketch/MySketch.ino
```

Finally, to upload:

```bash
docker exec -it arduino-cli upload \
    --fqbn esp32:esp32:esp32 \
    -p /dev/ttyUSB0 \
    MySketch/MySketch.ino
```

## How to compile

Please check the `scripts/build.sh` script.

```text
build.sh [--push] <COMMAND> <DISTRO> [<CLI_TAG> [<LIB_TAG>]]
```

Build an image. If tags are not provided, the script tries to get it from
the latest `git` tag (format: `<CLI_TAG>-lib<LIB_TAG>`).

Where:

* COMMAND: `cli` or `lib`
* CLI_TAG: the `arduino-cli` version to use
* DISTRO: `alpine` or `debian`
* LIB_TAG: if COMMAND is `lib`, the progressive number for the lib image

Options:

* `--push`: also push the built image to the registry


## Licenses and contributors

The code provided in this repo is release under the MIT License.
@copyright 2024 Francesco Stefanni

All the code and binaries provided inside the generated images belong to their
respective holders and are distributed under their respective licenses.

This project is sponsored by [Gizero Energie s.r.l.](www.gizeroenergie.it)
